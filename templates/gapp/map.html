<!DOCTYPE html>
{% load staticfiles %}
<html> 
<head> 
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" /> 
  <title>Google Maps Multiple Markers</title> 
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
</head> 

<body>
  <div id="map" style="width: 500px; height: 500px;"></div><br>

   <form class ="select_option" action="" method="post">{% csrf_token %}
		<select name="locations" onchange="showLocation(this.value)">
		    {% for option in options%}
		       <option value="{{ option.id }}">{{ option.name }}</option>
		    {% endfor %}
			
		</select>
   </form>

  <!--img id="img" src="{% static "images/marker.png" %}" alt="markerimage" /-->


 <script type="text/javascript">
    
    function initialize() {
	    var mapDiv = document.getElementById('map');
	    map = new google.maps.Map(mapDiv, {
	      center: new google.maps.LatLng(48.208174,16.373819),
	      zoom: 8,
	      mapTypeId: google.maps.MapTypeId.ROADMAP
	    });
	    var arr = {{ name_list_json|safe }};
	    // for(i=0;i<arr.length;i++){
	    // 	// arr[i][2]=arr[i][2].split(',')
	    // 	console.log((arr[i][2][0]));
	    // }
        google.maps.event.addListenerOnce(map, 'tilesloaded', addMarkers(arr));
    }

    function addMarkers(zone) {
    	   var bounds = new google.maps.LatLngBounds();

    	   for(i=0;i<zone.length;i++){
    	   	  zone[i][2]=zone[i][2].split(',')
    	   	  // console.log(zone[i][2][1])
    	   	  var point = new google.maps.LatLng(zone[i][2][0], zone[i][2][1]);
		        // var image = "{% static 'images/marker.png' %}"
		        var marker = new google.maps.Marker({
		        position: point,
		        map: map,
		        // icon: image,
		       title: zone[i][1],
		       draggable: false,
		      });

		      bounds.extend(marker.position);

		      google.maps.event.addListener(marker, 'click', function() {
		        this['infowindow'].open(map, this);
		      });

    	    }
    	  
		  // {% for mark in zone %}
		  //   var point = new google.maps.LatLng({{mark.position.latitude}},{{mark.position.longitude}});
		  //       // var image = "{% static 'images/marker.png' %}"
		  //       var marker = new google.maps.Marker({
		  //       position: point,
		  //       map: map,
		  //       // icon: image,
		  //      title: '{{ mark.address }}',
		  //      draggable: false,
		  //   });

		  //   bounds.extend(marker.position);

		  //   google.maps.event.addListener(marker, 'click', function() {
		  //       this['infowindow'].open(map, this);
		  //   });

		  //   {% endfor %} 
		    map.setCenter(bounds.getCenter());
            map.fitBounds(bounds);
    }

    google.maps.event.addDomListener(window, 'load', initialize);

    function showLocation(str) {

    	$.ajax({
        url: "{% url 'gapp:index' %}",
        type: "POST",
        data: {
        	id: str,
        	csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
        },
        success: function(data) {
        	// console.log("success");
        	google.maps.event.addDomListener(window, 'load');
        	alert("option changed");
        	console.log(data);
        	addMarkers(data)

        }});
	}

  </script>  
</body>
</html>
